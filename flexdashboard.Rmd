---
title: "Nécessité de détailler l'IDH"
author: "Laurine KOMENDANCZYK & Yannis BARBA"
output: 
  flexdashboard::flex_dashboard:
    theme: bootstrap
    orientation: columns
    vertical_layout: fill
    navbar:
      - { title: "Moodle", href: "https://tice.agrocampus-ouest.fr/course/view.php?id=6726", align: left }
      - { icon: "fa-twitter", href: "https://twitter.com/marie_etienne", align: right }
      - { icon: "fa-linkedin", href: "https://www.linkedin.com/in/marie-etienne-818a7115/", align: right }
params:
  setup_path: ../resources/
---

<style>                     
.navbar {
  background-color:#46ACC8;
  border-color:#46ACC8;
}
.navbar-brand {
color:black!important;
}


</style>   


```{r setup, include=FALSE}
library('flexdashboard')
library('plotly')
library('tidyverse')
library('ggplot2')
library("ggthemes")
library("gridExtra")
library("sf")
library("rnaturalearth")
library("rnaturalearthdata")
library("ggnewscale")
```

Column {data-width=650}
-----------------------------------------------------------------------

### An easy solution for dashboard

```{r, echo = TRUE}
#install.package('flexdasboard')
#rmarkdown::draft("dashboard.Rmd", template = "flex_dashboard", package = "flexdashboard")
```

The [flexdashboard website](https://rmarkdown.rstudio.com/flexdashboard/index.html) provides multiple advanced examples.

```{r}
data <- read.csv("./dataset/HDI.csv", sep=",", header = TRUE)
world <- ne_countries(scale = "medium", returnclass = "sf")

## Data pre-processing : rename of certain value
data[data$Country == "Congo (Democratic Republic of the)", "Country"] <- "Democratic Republic of the Congo"
data[data$Country == "Congo", "Country"] <- "Republic of Congo"
data[data$Country == "Tanzania (United Republic of)", "Country"] <- "Tanzania"
data[data$Country == "Bolivia (Plurinational State of)", "Country"] <- "Bolivia"
data[data$Country == "Korea (Republic of)", "Country"] <- "Republic of Korea" 

complete_data <- world %>% rename(Country = name_long) %>% inner_join(data, by="Country")

## Focus on africa

africa_data <- complete_data %>% filter(continent == "Africa")

## extract centroid 
sf_use_s2(FALSE)
countries_centroid <- st_centroid(africa_data$geometry)

africa_data <- cbind(africa_data, centroid = st_centroid(africa_data$geometry))
```

```{r}
# create HDI class for a better representation
africa_data <- africa_data %>% drop_na(HDI)
HDISummary <- summary(africa_data$HDI)

HDIClass <- apply(africa_data, MARGIN = 1, FUN= function(x){
  
  if(as.numeric(x["HDI"]) <= HDISummary["1st Qu."]){
    return("TB")
  }
  if((as.numeric(x["HDI"]) > HDISummary["1st Qu."]) && (as.numeric(x["HDI"]) <=HDISummary["Median"])){
    return("B")
  }
  if((as.numeric(x["HDI"]) > HDISummary["Median"]) && (as.numeric(x["HDI"]) <=HDISummary["3rd Qu."])){
    return("M")
  }
  if(as.numeric(x["HDI"]) > HDISummary["3rd Qu."]){
    return("E")
  }
})

africa_data$HDIClass <- HDIClass
```


### First Graph

```{r}
# Plot first Map, Africa HDI and School
map_HDI_School <- africa_data %>%  ggplot() + 
  #labs(title="Les limites de l'IDH",
   #       subtitle = "Absence de prise en compte des inégalités") +
  
  geom_sf(aes(fill=HDI)) +
  scale_fill_gradientn("IDH", colors=c("#DFD0BD", "#5B4A54")) +

  geom_sf(aes(geometry = geometry.1, color=HDIClass , size=Inequality.in.income....)) +

  scale_color_manual("Classes IDH", values=c("black", "#E64814", "#E9CB0D", "#9CDE3B"), 
                     breaks=c("TB", "B", "M", "E"), labels=c("Très Bas", "Bas", "Moyen", "Élevé")) +

  scale_size(name="Inégalité d'income") +
  theme_tufte() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank()) +
  guides(fill = guide_colourbar(order=1),
         color = guide_legend(order=2),
         size = guide_legend(order=3))

map_HDI_School
```

Column {.tabset .tabset-fade}
-----------------------------------------------------------------------


### Second Graph

```{r}
africa_data$RatioIDHI_IDH <- africa_data$Inequality.adjusted.HDI..IHDI. / africa_data$HDI

country <- africa_data$Country
highlightCountries <- rep(0, length(country))

highlightCountries[which(country=="South Africa")] <- data.frame(africa_data[which(country=="South Africa"),"RatioIDHI_IDH"])[-2][1,1]

highlightCountries[which(country=="Niger")] <- data.frame(africa_data[which(country=="Niger"),"RatioIDHI_IDH"])[-2][1,1]

ratio_graph <- africa_data %>% drop_na(Inequality.adjusted.HDI..IHDI.) %>% 
  
  ggplot() +
  
  # annotate("rect",
  #          xmin = Inf, xmax = 0, ymin = Inf, ymax = 0,
  #          fill=rgb(255, 204, 200,maxColorValue=255)) +
  geom_col(aes(y=reorder(Country, RatioIDHI_IDH), x=RatioIDHI_IDH, fill=HDIClass), width = 0.95) +
  scale_fill_manual("Classes IDH", values=c("#9CDE3B","#E9CB0D", "#E64814","black"),
                     breaks=c("E", "M", "B","TB"), labels=c("Élevé", "Moyen", "Bas","Très Bas"))+

  
  #geom_point(aes(x = reorder(Country, HDI), y=HDI, fill=HDIClass), width = 0.95) +
  
  # geom_col(data = data.frame(IHDI = africa_data$Inequality.adjusted.HDI..IHDI.,
  #                            Country=africa_data$Country, HDI=africa_data$HDI),
  #          aes(x=reorder(Country, HDI), y=IHDI), fill="darkred", width = 1) +
  
  labs(x="IHDI/HDI", y =element_blank()) +
  
  theme_light()+
  theme(axis.text.x = element_text(hjust=1),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_line(color = "grey",
                                  size = 0.2,
                                  linetype = 1),
        panel.border = element_blank()
        ) +
  scale_x_continuous(breaks = seq(0,1, 0.1), limits = c(0,1))

ratio_graph
```



### Third Graph

```{r}

```

